---
title: "The Challenges of Resampling for Graphics"
format:
  jasa-pdf:
    keep-tex: true  
    journal:
      blinded: false
  jasa-html: default
date: last-modified
author:
  - name: Susan Vanderplas
    affiliations:
      - name: University of Nebraska Lincoln
        department: Statistics Department
  - name: Dianne Cook
    affiliations:
      - name: Monash University
        department: Department of Econometrics and Business Statistics
    acknowledgements: | 
      The authors gratefully acknowledge _please remember to list all relevant funding sources in the non-anonymized (unblinded) version_.
abstract: |
  The text of your abstract. 200 or fewer words.
keywords:
  - 3 to 6 keywords
  - that do not appear in the title
bibliography: bibliography.bib  
---


```{r get-nhanes-data, include = F}
if (!file.exists("data/NHANES_sleep_raw.csv")) {
  if (!"nhanesA" %in% installed.packages()) devtools::install_github("cjendres1/nhanes")
  library(nhanesA)
  library(tidyverse)
  demo_table <- nhanesTables(data_group='DEMO', year=2011) %>%
    `[[`('Data.File.Name') %>%
    nhanes()
  
  sleep_table <- nhanesTables(data_group="Q",  year = 2011) %>%
    filter(str_detect(Data.File.Name, "SLQ")) %>%
    `[[`('Data.File.Name') %>%
    nhanes()
  
  depression_table <- nhanes("DPQ_G") 
  
  homeowner_table <- nhanes("HOQ_G")
  
  # Still can't figure out what the smoke100 column is in the data in the book, but not sure it matters.
  
  nhanes_sleep <- full_join(demo_table, sleep_table, by = "SEQN") %>%
    full_join(depression_table, by = "SEQN") %>%
    full_join(homeowner_table, by = "SEQN") %>%
    select(SEQN, Gender = RIAGENDR, Age = RIDAGEYR, HomeOwn = HOQ065, SleepHoursNight = SLD010H)
  
  write_csv(nhanes_sleep, "data/NHANES_sleep_raw.csv")
} else {
  nhanes_sleep <- read_csv("data/NHANES_sleep_raw.csv")
}
```


## Introduction {#sec-intro}

<!-- What about https://bookdown.org/jgscott/DSGI/the-bootstrap.html#bootstrapping-summaries as an example dataset? Sleep data from NHANES 2011-12.  -->

<!-- Define bootstrap, and varieties, and examples of use, with tables of numbers.  -->
<!-- - Lay out the situations where resampling/bootstrap are useful. -->
<!-- - Primarily, used to get a sense of the behavior/distribution of a statistic -->

We frequently come across data which does not come with an attached standard distribution (or any theoretical reasons we might assume such a distribution).
In these cases, we still may want to understand the uncertainty in our estimates, but we do not have distributional theory to rely on; instead, we may use resampling to assess the variability of estimates via the **bootstrap**. 
The bootstrap works via the assumption that the main source of variability in the estimate is the sampling process; by resampling the data, we can mimic the variability of the process in order to understand the resulting variability of the estimates.

Bootstrap estimates work fantastically well when used to estimate quantities which depend on the "body" of the data (the middle portion, excluding the tails), but tend to fail when quantities are dependent on the tails, because these are relatively low probability observations. 





Introduce lineup/Rorschach protocols. Graphics are statistics, but ultimately, resampling/bootstrap methods are of limited use in graphics because of two primary issues: 
- overplotting, which limits the utility of resampling because of lack of visual novelty, and 
- limited ability to evaluate the test statistics - we can computationally evaluate thousands of samples in fractions of a second, but viewing thousands of plots is much more time consuming.

Why? Motivational example: Classic bootstrap example, and show what happens with plots - points disappear.

Structure of this paper?

## Bootstrap effect on plots

Outline of commonly used bootstrap/resampling approaches and evaluation of graphical challenges. Need to show this with lineups.

- bootstrap problem:
    - scatterplot
    - histogram should be ok, but could have unusually high bars
    - density plots also should be ok, but might have bibbles og high-density
- parametric bootstrap
- residual resampling (https://bookdown.org/jgscott/DSGI/the-bootstrap.html#bootstrapping-summaries footnote)
- permutation
- high-dimensions?

Solutions

- jitter - persistent


```{r get-nhanes-data}
if (!file.exists("data/NHANES_sleep_raw.csv")) {
  if (!"nhanesA" %in% installed.packages()) devtools::install_github("cjendres1/nhanes")
  library(nhanesA)
  library(tidyverse)
  demo_table <- nhanesTables(data_group='DEMO', year=2011) %>%
    `[[`('Data.File.Name') %>%
    nhanes()
  
  sleep_table <- nhanesTables(data_group="Q",  year = 2011) %>%
    filter(str_detect(Data.File.Name, "SLQ")) %>%
    `[[`('Data.File.Name') %>%
    nhanes()
  
  depression_table <- nhanes("DPQ_G") 
  
  homeowner_table <- nhanes("HOQ_G")
  
  # Still can't figure out what the smoke100 column is in the data in the book, but not sure it matters.
  
  nhanes_sleep <- full_join(demo_table, sleep_table, by = "SEQN") %>%
    full_join(depression_table, by = "SEQN") %>%
    full_join(homeowner_table, by = "SEQN") %>%
    select(SEQN, Gender = RIAGENDR, Age = RIDAGEYR, HomeOwn = HOQ065, SleepHoursNight = SLD010H)
  
  write_csv(nhanes_sleep, "data/NHANES_sleep_raw.csv")
} else {
  nhanes_sleep <- read_csv("data/NHANES_sleep_raw.csv")
}

```

```{r}
#| eval: false
library(tidyverse)
library(patchwork)
library(ggbeeswarm)
set.seed(1152)
NHANES_sleep <- read_csv("data/NHANES_sleep.csv")
n <- nrow(NHANES_sleep)
bin <- 1
nh_sample <- sample_frac(NHANES_sleep, 0.1)
d <- nh_sample %>% 
  select(SleepHrsNight) %>%
  rename(b0 = SleepHrsNight) %>%
  mutate(b1 = sample(b0, replace=TRUE),
         b2 = sample(b0, replace=TRUE),
         b3 = sample(b0, replace=TRUE)) %>%
  pivot_longer(cols=everything(), names_to="sample", values_to="b")
ggplot(d) + 
  geom_histogram(aes(x = b), binwidth=bin) +
  facet_wrap(~sample, ncol=2)
ggplot(d) + 
  geom_quasirandom(aes(x = sample, y=b), alpha=0.1) 
ggplot(d) + 
  geom_violin(aes(x = sample, y=b)) 
ggplot(d) + 
  geom_boxplot(aes(x = sample, y=b)) 
```

There is a sample size effect: large samples probably not many issues. Smaller samples, eg 10% of the NHANES (~800 observations) there is 
- piling in the histogram
- pitted patterns in jittered dotplot
- extremes missing in violin plots and boxplots


---

## Disclosure statement
, 
The authors have the following conflicts of interest to declare (or replace with a statement that no conflicts of interest exist).

## Data Availability Statement

Deidentified data have been made available at the following URL: XX.

## Supplementary Material {.supplementary}

Title:

:   Brief description. (file type)


R-package for  MYNEW routine: 

:   R-package MYNEW containing code to perform the diagnostic methods described in the article. The package also contains all datasets used as examples in the article. (GNU zipped tar file)

HIV data set:

:   Data set used in the illustration of MYNEW method in @sec-verify (.txt file).

## BibTeX 

We encourage you to use BibTeX.
If you have, please feel free to use the package natbib with any bibliography style you're comfortable with. The .bst file agsm has been included here for your convenience. 

https://doi.org/10.1214%2Faos%2F1176344552

https://doi.org/10.2307%2F2289144

https://bookdown.org/jgscott/DSGI/the-bootstrap.html#bootstrapping-summaries


